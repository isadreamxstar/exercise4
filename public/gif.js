(function(l){function e(c,f){if({}.hasOwnProperty.call(e.cache,c))return e.cache[c];var i=e.resolve(c);if(!i)throw Error("Failed to resolve module "+c);var b={id:c,require:e,filename:c,exports:{},loaded:!1,parent:f,children:[]};f&&f.children.push(b);var a=c.slice(0,c.lastIndexOf("/")+1);return e.cache[c]=b.exports,i.call(b.exports,b,b.exports,a,c),b.loaded=!0,e.cache[c]=b.exports}e.modules={};e.cache={};e.resolve=function(c){return{}.hasOwnProperty.call(e.modules,c)?e.modules[c]:void 0};e.define=
function(c,f){e.modules[c]=f};var j=function(c){return c="/",{title:"browser",version:"v0.10.5",browser:!0,env:{},argv:[],nextTick:l.setImmediate||function(c){setTimeout(c,0)},cwd:function(){return c},chdir:function(f){c=f}}}();e.define("/gif.coffee",function(c){function f(a,h){function c(){this.constructor=a}for(var b in h)({}).hasOwnProperty.call(h,b)&&(a[b]=h[b]);return c.prototype=h.prototype,a.prototype=new c,a.__super__=h.prototype,a}var i,b;b=e("events",c).EventEmitter;i=e("/browser.coffee",
c);b=function(a,h,c){function b(d){var g;this.running=!1;this.options={};this.frames=[];this.freeWorkers=[];this.activeWorkers=[];this.setOptions(d);for(g in h)d=h[g],null!=this.options[g]||(this.options[g]=d)}return f(b,a),h={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null},c={delay:500,copy:!1},b.prototype.setOption=function(d,g){return this.options[d]=g,null!=this._canvas&&("width"===d||"height"===d)?this._canvas[d]=g:void 0},b.prototype.setOptions=
function(d){var g=[],a,b;for(a in d)({}).hasOwnProperty.call(d,a)&&(b=d[a],g.push(this.setOption(a,b)));return g},b.prototype.addFrame=function(d,g){var a,b;null==g&&(g={});a={};for(b in c)a[b]=g[b]||c[b];if("undefined"!==typeof CanvasRenderingContext2D&&null!=CanvasRenderingContext2D&&d instanceof CanvasRenderingContext2D||"undefined"!==typeof WebGLRenderingContext&&null!=WebGLRenderingContext&&d instanceof WebGLRenderingContext)g.copy?a.data=this.getContextData(d):a.context=d;else if(null!=d.childNodes)null!=
this.options.width||this.setOption("width",d.width),null!=this.options.height||this.setOption("height",d.height),g.copy?a.data=this.getImageData(d):a.image=d;else throw Error("Invalid image");return this.frames.push(a),null!=a.width&&this.setOption("width",a.width),null!=a.height?this.setOption("height",a.height):void 0},b.prototype.render=function(){var d;if(this.running)throw Error("Already running");this.running=!0;this.finishedFrames=this.nextFrame=0;this.imageParts=function(d){for(var a=0,b=
function(){var d;d=[];for(var a=0;0<=this.frames.length?a<this.frames.length:a>this.frames.length;0<=this.frames.length?++a:--a)d.push(a);return d}.apply(this,arguments).length;a<b;++a)(function(){var d;d=[];for(var a=0;0<=this.frames.length?a<this.frames.length:a>this.frames.length;0<=this.frames.length?++a:--a)d.push(a);return d}).apply(this,arguments),d.push(null);return d}.call(this,[]);d=this.spawnWorkers();for(var a=0,b=function(){var a;a=[];for(var b=0;0<=d?b<d:b>d;0<=d?++b:--b)a.push(b);return a}.apply(this,
arguments).length;a<b;++a)(function(){var a;a=[];for(var b=0;0<=d?b<d:b>d;0<=d?++b:--b)a.push(b);return a}).apply(this,arguments),this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},b.prototype.abort=function(){for(var d;!(d=this.activeWorkers.shift(),null==d);)console.log("killing active worker"),d.terminate();return this.running=!1,this.emit("abort")},b.prototype.spawnWorkers=function(){var d,a;d=Math.min(this.options.workers,this.frames.length);for(var b=0,c=function(){var a;
a=[];for(var b=this.freeWorkers.length;this.freeWorkers.length<=d?b<d:b>d;this.freeWorkers.length<=d?++b:--b)a.push(b);return a}.apply(this,arguments).length;b<c;++b)(function(){var a;a=[];for(var b=this.freeWorkers.length;this.freeWorkers.length<=d?b<d:b>d;this.freeWorkers.length<=d?++b:--b)a.push(b);return a}).apply(this,arguments),(a=this,function(){var d,b;return void 0,b=new Worker(a.options.workerScript),d=a,b.onmessage=function(a){return d.activeWorkers.splice(d.activeWorkers.indexOf(b),1),
d.freeWorkers.push(b),d.frameFinished(a.data)},a.freeWorkers.push(b)})();return d},b.prototype.frameFinished=function(a){void 0;this.finishedFrames++;this.emit("progress",this.finishedFrames/this.frames.length);this.imageParts[a.index]=a;a:{for(var a=this.imageParts,b=0,c=a.length;b<c;++b)if(b in a&&null===a[b]){a=!0;break a}a=!1}return a?this.renderNextFrame():this.finishRendering()},b.prototype.finishRendering=function(){var a,b,c,h,f,i;c=a=0;for(f=this.imageParts.length;c<f;++c)b=this.imageParts[c],
a+=(b.data.length-1)*b.pageSize+b.cursor;a+=b.pageSize-b.cursor;console.log("rendering finished - filesize "+Math.round(a/1E3)+"kb");a=new Uint8Array(a);for(var e=f=0,m=this.imageParts.length;e<m;++e){b=this.imageParts[e];for(var k=0,j=b.data.length;k<j;++k)i=b.data[k],c=k,a.set(i,f),c===b.data.length-1?f+=b.cursor:f+=b.pageSize}return h=new Blob([a],{type:"image/gif"}),this.emit("finished",h,a)},b.prototype.renderNextFrame=function(){var a,b,c;if(0===this.freeWorkers.length)throw Error("No free workers");
return this.nextFrame>=this.frames.length?void 0:(a=this.frames[this.nextFrame++],c=this.freeWorkers.shift(),b=this.getTask(a),this.activeWorkers.push(c),c.postMessage(b))},b.prototype.getContextData=function(a){return a.getImageData(0,0,this.options.width,this.options.height).data},b.prototype.getImageData=function(a){var b;return null!=this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),b=this._canvas.getContext("2d"),
b.setFill=this.options.background,b.fillRect(0,0,this.options.width,this.options.height),b.drawImage(a,0,0),this.getContextData(b)},b.prototype.getTask=function(a){var b,c;if(b=this.frames.indexOf(a),c={index:b,last:b===this.frames.length-1,delay:a.delay,width:this.options.width,height:this.options.height,quality:this.options.quality,repeat:this.options.repeat,canTransfer:"chrome"===i.name},null!=a.data)c.data=a.data;else if(null!=a.context)c.data=this.getContextData(a.context);else if(null!=a.image)c.data=
this.getImageData(a.image);else throw Error("Invalid frame");return c},b}(b);c.exports=b});e.define("/browser.coffee",function(c){var f,e,b;e=navigator.userAgent.toLowerCase();f=navigator.platform.toLowerCase();b=e.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0];f={name:"version"===b[1]?b[3]:b[1],version:"ie"===b[1]&&document.documentMode||parseFloat("opera"===b[1]&&b[4]?b[4]:b[2]),platform:{name:e.match(/ip(?:ad|od|hone)/)?
"ios":(e.match(/(?:webos|android)/)||f.match(/mac|win|linux/)||["other"])[0]}};f[f.name]=!0;f[f.name+parseInt(f.version,10)]=!0;f.platform[f.platform.name]=!0;c.exports=f});e.define("events",function(c,f){j.EventEmitter||(j.EventEmitter=function(){});var e=f.EventEmitter=j.EventEmitter,b="function"===typeof Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)};e.prototype.setMaxListeners=function(a){this._events||(this._events={});this._events.maxListeners=
a};e.prototype.emit=function(a){if("error"===a&&(!this._events||!this._events.error||b(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var c=this._events[a];if(!c)return!1;if("function"!=typeof c){if(b(c)){for(var e=Array.prototype.slice.call(arguments,1),c=c.slice(),f=0,d=c.length;f<d;f++)c[f].apply(this,e);return!0}return!1}switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,
arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:e=Array.prototype.slice.call(arguments,1),c.apply(this,e)}return!0};e.prototype.addListener=function(a,c){if("function"!==typeof c)throw Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",a,c),!this._events[a])this._events[a]=c;else if(b(this._events[a])){if(!this._events[a].warned){var e;void 0!==this._events.maxListeners?e=this._events.maxListeners:e=10;e&&
0<e&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),console.trace())}this._events[a].push(c)}else this._events[a]=[this._events[a],c];return this};e.prototype.on=e.prototype.addListener;e.prototype.once=function(a,b){var c=this;return c.on(a,function d(){c.removeListener(a,d);b.apply(this,arguments)}),this};e.prototype.removeListener=
function(a,c){if("function"!==typeof c)throw Error("removeListener only takes instances of Function");if(!this._events||!this._events[a])return this;var e=this._events[a];if(b(e)){var f=e.indexOf(c);if(0>f)return this;e.splice(f,1);0==e.length&&delete this._events[a]}else this._events[a]===c&&delete this._events[a];return this};e.prototype.removeAllListeners=function(a){return a&&this._events&&this._events[a]&&(this._events[a]=null),this};e.prototype.listeners=function(a){return this._events||(this._events=
{}),this._events[a]||(this._events[a]=[]),b(this._events[a])||(this._events[a]=[this._events[a]]),this._events[a]}});l.GIF=e("/gif.coffee")}).call(this,this);
