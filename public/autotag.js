(function(b,e){function s(b){b.stopPropagation()}var x=b(window),y={items:[],separator:",",allowDupes:!1,maxTags:0};b.fn.autotag=function(k){function z(){var a=l.val().split(o);for(p=0;p<a.length;p++)m(b.trim(a[p]))}function t(){var a=h.val();if(a!==i){i=a;f=-1;j=[];for(var a=0,b=RegExp(i,"ig"),g=0;g<u.length;g++){var e=u[g];-1!=e.search(b)&&(j[a]=e,a++)}if(j.length&&(i||0===d.length)){b="";for(g=0;g<a;g++)b+='<div id="atg-'+g+'" data-index="'+g+'" class="atg-item">'+j[g]+"</div>";c.html(b);c.css("display",
"block");n=c.find(".atg-item").eq(0).outerHeight()}else c.hide()}}function m(a){if(!(d.length>=k.maxTags)&&(a=b.trim(a.replace(A,"")),""!==a&&(k.allowDupes||-1===d.indexOf(a))))d.push(a),b(e.createElement("div")).attr("class","atg-tag").append(b(e.createElement("span")).attr("class","atg-tag-text").text(a)).append('<span class="atg-x">\u00d7</span>').insertBefore(h),l.val(d.join(o)),i="",h.val(""),j=[],f=-1,c.hide()}function v(a){a=d.indexOf(a);-1!==a&&(d.splice(a,1),q.find(".atg-tag").eq(a).remove(),
l.val(d.join(o)))}function r(a){f=a>>=0;c.find(".atg-item").removeClass("atg-active");if(-1!==a){b("#atg-"+a).addClass("atg-active");var d=c.scrollTop();a*n<d?c.scrollTop(a*n):(a+1)*n>c.height()+d&&c.scrollTop((a+1)*n-c.height())}}function B(){h.keyup(function(a){27===a.which?c.hide():C[a.which]||t()}).keydown(function(a){var b=a.which;return 8===b&&""===h.val()?(v(d[d.length-1]),!1):13===b?(-1!==f&&"none"!==c.css("display")?m(c.find(".atg-item").eq(f).text()):m(h.val()),!1):188===b?(m(h.val()),!1):
i&&(38===b||a.shiftKey&&9===b)?(-1<f&&r(f-1),!1):i&&(40===b||9===b)?(f+1<j.length&&r(f+1),!1):!0}).focus(function(){i&&j.length?c.css("display","block"):0===d.length&&t()}).click(s);q.on("click",".atg-x",function(){v(b(this).siblings(".atg-tag-text").text())}).on("click",function(a){a.stopPropagation();h.focus()});c.on("mouseover",".atg-item",function(){r(b(this).data("index"))}).on("click",".atg-item",function(){m(b(this).text())}).on("click",s);x.click(function(){c.hide()})}var l=this;if(!l.data("atg")){var k=
b.extend(y,k),o=k.separator,u=k.items,d=[],j=[],f=-1,i="",p,n=0,C={9:!0,13:!0,38:!0,40:!0,188:!0},w=b(e.createElement("div")).attr("class","atg-wrap").insertBefore(l),q=b(e.createElement("div")).attr("class","atg-tags").appendTo(w),h=b(e.createElement("input")).attr({"class":"atg-input",type:"text",autocomplete:"off"}).appendTo(q),c=b(e.createElement("div")).attr("class","atg-items").appendTo(w);l.hide().data("atg",!0);var A=RegExp(o,"g");B();z()}}})(jQuery,document);
